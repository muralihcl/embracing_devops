---
- name: Work with kubernetes using ansible
  hosts: all
  gather_facts: false
  tasks:
    - name: Get kubernetes cluster information
      kubernetes.core.k8s_cluster_info:
      register: reg_k8s_info

    - name: Display cluster status
      ansible.builtin.debug:
        msg: "{{ reg_k8s_info }}"

    - name: Create a k8s namespace
      kubernetes.core.k8s:
        name: training
        api_version: v1
        kind: Namespace
        state: present

    - name: create resource using name generated by the server
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Pod
          metadata:
            namespace: training
            name: web
            labels:
              app: web
          spec:
            containers:
            - name: nginx
              image: nginx
              ports:
                - containerPort: 80

    - name: Create a Service object from an inline definition
      kubernetes.core.k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Service
          metadata:
            labels:
              app: web
            name: web-service
            namespace: training
          spec:
            ports:
            - port: 80
              protocol: TCP
              targetPort: 80
              nodePort: 30001
            selector:
              app: web
            type: NodePort

